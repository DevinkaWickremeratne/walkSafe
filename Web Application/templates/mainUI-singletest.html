<!doctype html>
<html lang="en">
  <head>
    <title>Main Page</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
    
    </style>

    <link href="https://fonts.googleapis.com/css?family=Rubik:300,400,700|Oswald:400,700" rel="stylesheet">
    <link rel="stylesheet" href="../static/fonts/icomoon/style.css">
    <link rel="stylesheet" href="../static/css/bootstrap.min.css">
    <link rel="stylesheet" href="../static/css/jquery.fancybox.min.css">
    <link rel="stylesheet" href="../static/css/owl.carousel.min.css">
    <link rel="stylesheet" href="../static/css/owl.theme.default.min.css">
    <link rel="stylesheet" href="../static/fonts/flaticon/font/flaticon.css">
    <link rel="stylesheet" href="../static/css/aos.css">

    <!-- MAIN CSS -->
    <!-- <link rel="stylesheet" href="../static/css/style.css"> -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}"
  </head>
  <body data-spy="scroll" data-target=".site-navbar-target" data-offset="300">
  
    <div class="site-wrap">

      <div class="site-mobile-menu site-navbar-target">
        <div class="site-mobile-menu-header">
          <div class="site-mobile-menu-close mt-3">
            <span class="icon-close2 js-menu-toggle"></span>
          </div>
        </div>
        <div class="site-mobile-menu-body"></div>
      </div>
     


      <header class="site-navbar js-sticky-header site-navbar-target" role="banner">

        <div class="container">
          <div class="row align-items-center position-relative">
            
              
              <div class="site-logo">
                <a href="index.html" class="text-black"><span class="text-primary">WalkSafe</a>
              </div>
              
              <div class="col-12">
                <nav class="site-navigation text-right ml-auto " role="navigation">

                  <ul class="site-menu main-menu js-clone-nav ml-auto d-none d-lg-block">
                  <li><a href="{{ url_for('main') }}" class="nav-link">Home</a></li>
                  <li><a href="{{ url_for('main') }}" class="nav-link">Background</a></li>
                  <li><a href="{{ url_for('main') }}" class="nav-link">Features</a></li>                
                  <li><a href="{{ url_for('main') }}" class="nav-link">Developer</a></li>
                 
                  <!--User Profile with drop down Logout option-->
                  <li class="has-children">
                    <a href="#" class="nav-link active">{{ guardian_first_name }}</a>
                    <ul class="dropdown arrow-top">
                      <li><a href="{{ url_for('logout') }}" class="nav-link">Logout</a></li>
                    </ul>
                  </li>
                </ul>
                </nav> 
              </div>

            <div class="toggle-button d-inline-block d-lg-none"><a href="#" class="site-menu-toggle py-5 js-menu-toggle text-black"><span class="icon-menu h3"></span></a></div>

          </div>
        </div>
        
      </header>
      
      
      
      <section class="site-section" style="padding-top: 10px; padding-bottom: 10px">
        <div class="container-fluid">
         

          <div class="row">

            
            <div class="col-md-3 cameraFeedContainer">
              <div class="row">
                <div class=" alertBox box">
                  <span>SOS Emergency Alert Notification</span><br>
                  <image src="../static/images/sos-icon.png" height="50px" width="50px">
                </div>
              </div>  
              <div class="row battery">
                <!--Battery Percentage Indicator-->
                <div class="batteryBox">
                  <img src="../static/images/battery-icon.png" class="battery-icon">
                </div>
              </div> 
              <div class="row">
                <!--Real-time camera feed from smart cane-->
                <div class="cameraFeed" style="float: right;">
                  <span> Real Time Camera Feed for User 2</span>
                  <image src="../static/images/video-icon.png" class="video-icon" >           
                </div> 
              </div> 
                    
            </div>

            <!--Tracking of user location-->
            <div class="col-md-9 mapContainer">
                <div class="map" id="map">
                   <!-- <span class="box" style="display: inline-block;">Map Container</span>
                   <img src="../static/images/map-icon.png" class="map-icon"> -->
                    
                
              </div>
            </div>
          </div>
          </div>
        </div>
      </section>

      <!-- <footer class="site-footer" style="padding-bottom: 0px; padding-top: 0px;">
        <div class="container">
          <div class="row" style="text-align: center;">
            <div style="text-align: center; margin: auto">
                <h2 class="footer-heading mb-4">Follow Us</h2>
                  <a href="#about-section" class="smoothscroll pl-0 pr-3"><span class="icon-facebook"></span></a>
                  <a href="#" class="pl-3 pr-3"><span class="icon-twitter"></span></a>
                  <a href="#" class="pl-3 pr-3"><span class="icon-instagram"></span></a>
                  <a href="#" class="pl-3 pr-3"><span class="icon-linkedin"></span></a>
            </div>
          </div>
        </div>  
        </div>
      </footer> -->
    </div>

    <script src="../static/js/jquery-3.3.1.min.js"></script>
    <script src="../static/js/popper.min.js"></script>
    <script src="../static/js/bootstrap.min.js"></script>
    <script src="../static/js/owl.carousel.min.js"></script>
    <script src="../static/js/jquery.sticky.js"></script>
    <script src="../static/js/jquery.waypoints.min.js"></script>
    <script src="../static/js/jquery.animateNumber.min.js"></script>
    <script src="../static/js/jquery.easing.1.3.js"></script>
    <script src="../static/js/aos.js"></script>
    <script src="../static/js/main.js"></script>
    <script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.23.0.js"></script>

     <script>
  // the smooth zoom function
  function smoothZoom (map, max, cnt) {
      if (cnt >= max) {
          return;
      }
      else {
          z = google.maps.event.addListener(map, 'zoom_changed', function(event){
              google.maps.event.removeListener(z);
              smoothZoom(map, max, cnt + 1);
          });
          setTimeout(function(){map.setZoom(cnt)}, 80); // 80ms is what I found to work well on my system -- it might not work well on all systems
      }
  } 
    var pubnub = new PubNub({
    subscribeKey: "sub-c-e293e37a-4770-11ea-aca8-a22e61d49bc9",
    ssl: true
  });  
  var longitude = 79.8645096;
  var latitude = 6.8394699;
  pubnub.addListener({
      message: function(m) {
          // handle message
          var channelName = m.channel; // The channel for which the message belongs
          var channelGroup = m.subscription; // The channel group or wildcard subscription match (if exists)
          var pubTT = m.timetoken; // Publish timetoken
          var msg = m.message; // The Payload
          longitude = msg.longitude;
          latitude = msg.latitude;
          var publisher = m.publisher; //The Publisher
    var myLatlng = new google.maps.LatLng(latitude, longitude);
    var marker = new google.maps.Marker({
        position: myLatlng,
        title:"PubNub GPS"
    });
    // To add the marker to the map, call setMap();
    map.setCenter(marker.position);
    smoothZoom(map, 14, map.getZoom());
    marker.setMap(map);
      },
      presence: function(p) {
          // handle presence
          var action = p.action; // Can be join, leave, state-change or timeout
          var channelName = p.channel; // The channel for which the message belongs
          var occupancy = p.occupancy; // No. of users connected with the channel
          var state = p.state; // User State
          var channelGroup = p.subscription; //  The channel group or wildcard subscription match (if exists)
          var publishTime = p.timestamp; // Publish timetoken
          var timetoken = p.timetoken;  // Current timetoken
          var uuid = p.uuid; // UUIDs of users who are connected with the channel
      },
      status: function(s) {
          var affectedChannelGroups = s.affectedChannelGroups;
          var affectedChannels = s.affectedChannels;
          var category = s.category;
          var operation = s.operation;
      }
  });
  pubnub.subscribe({
      channels: ['ch1'],
  });
      var map;
      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: latitude, lng: longitude},
          zoom: 20
        });
      }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDLX7mN6XdX8sO2VY3Sglyo0ItSlNUXoWw&callback=initMap"
    async defer></script>

  </body>
</html>